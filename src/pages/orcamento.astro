---
import BaseLayout from '../layouts/BaseLayout.astro';
import Button from '../components/ui/Button.astro';
---

<BaseLayout 
  title="Solicitar Orçamento | RN Transportes e Mudanças"
  description="Solicite seu orçamento gratuito de mudança. Preencha o formulário e retornaremos em breve. RN Transportes - Belo Horizonte e todo o Brasil."
  canonical="https://rntransportesbh.com.br/orcamento"
  keywords="orçamento mudança, orçamento mudanças BH, RN Transportes orçamento"
  url="https://rntransportesbh.com.br/orcamento"
>
  <div class="relative pt-24 pb-20 bg-[var(--color-background-dark)]">
    <!-- Formas geométricas – disposição em cantos (diferente das demais páginas) -->
    <div class="absolute inset-0 pointer-events-none hidden md:block z-0" aria-hidden="true">
      <div class="absolute left-[3%] top-[8%] w-8 h-8 bg-[var(--color-yellow)] opacity-58 rotate-45"></div>
      <div class="absolute right-[3%] top-[18%] w-6 h-10 bg-[var(--color-cyan)] opacity-55 -rotate-12"></div>
      <div class="absolute left-[2%] bottom-[12%] w-7 h-7 bg-[var(--color-cyan)] opacity-56"></div>
      <div class="absolute right-[3%] bottom-[10%] w-10 h-6 bg-[var(--color-yellow)] opacity-62 -rotate-6"></div>
    </div>
    <div class="container relative z-10 mx-auto px-6 py-12 max-w-xl">
      <div class="text-center mb-10">
        <a href="/" class="inline-block mb-6 hover:opacity-90 transition-opacity">
          <img src="/assets/logos/logo-rn-transportes.png" alt="RN Transportes e Mudanças" class="h-10 md:h-12 w-auto mx-auto" width="180" height="48" />
        </a>
        <h1 class="text-3xl md:text-4xl font-bold mb-4 text-[var(--color-platinum)]">
          Faça um orçamento gratuito
        </h1>
        <p class="text-[var(--color-platinum)]/70 text-lg">
          Preencha o formulário e solicite seu orçamento. Retornaremos em breve.
        </p>
      </div>

      <div class="bg-[var(--color-background)] rounded-xl p-6 md:p-8 border border-[var(--color-platinum)]/10">
        <form id="contact-form" class="space-y-5">
          <div>
            <label for="name" class="block text-[var(--color-platinum)] mb-2 font-medium">
              Nome completo <span class="text-red-400">*</span>
            </label>
            <input
              type="text"
              id="name"
              name="name"
              required
              class="w-full px-4 py-3 bg-[var(--color-background-dark)] border border-[var(--color-platinum)]/20 rounded-lg text-[var(--color-platinum)] focus:outline-none focus:ring-2 focus:ring-[var(--color-bondi-blue)] focus:border-transparent"
              placeholder="Seu nome"
            />
          </div>

          <div>
            <label for="phone" class="block text-[var(--color-platinum)] mb-2 font-medium">
              Telefone <span class="text-red-400">*</span>
            </label>
            <input
              type="tel"
              id="phone"
              name="phone"
              required
              class="w-full px-4 py-3 bg-[var(--color-background-dark)] border border-[var(--color-platinum)]/20 rounded-lg text-[var(--color-platinum)] focus:outline-none focus:ring-2 focus:ring-[var(--color-bondi-blue)] focus:border-transparent"
              placeholder="(31) 99999-9999"
            />
          </div>

          <div>
            <label for="email" class="block text-[var(--color-platinum)] mb-2 font-medium">
              Email <span class="text-red-400">*</span>
            </label>
            <input
              type="email"
              id="email"
              name="email"
              required
              class="w-full px-4 py-3 bg-[var(--color-background-dark)] border border-[var(--color-platinum)]/20 rounded-lg text-[var(--color-platinum)] focus:outline-none focus:ring-2 focus:ring-[var(--color-bondi-blue)] focus:border-transparent"
              placeholder="seu@email.com"
            />
          </div>

          <div>
            <label for="message" class="block text-[var(--color-platinum)] mb-2 font-medium">
              Deixe aqui sua mensagem <span class="text-red-400">*</span>
            </label>
            <textarea
              id="message"
              name="message"
              required
              rows="5"
              class="w-full px-4 py-3 bg-[var(--color-background-dark)] border border-[var(--color-platinum)]/20 rounded-lg text-[var(--color-platinum)] focus:outline-none focus:ring-2 focus:ring-[var(--color-bondi-blue)] focus:border-transparent resize-none"
              placeholder="Conte-nos sobre sua mudança: origem, destino, tipo (residencial/comercial), data aproximada..."
            ></textarea>
          </div>

          <div id="form-message" class="hidden p-4 rounded-lg"></div>

          <Button variant="primary" size="lg" class="w-full" type="submit">
            Quero um orçamento
          </Button>

          <p class="text-center text-sm text-[var(--color-platinum)]/60">
            Ou fale conosco pelo <a href="https://wa.me/5531988435877" target="_blank" rel="noopener noreferrer" class="text-[var(--color-bondi-blue)] hover:underline">WhatsApp</a>
          </p>
        </form>
      </div>

      <div class="mt-8 text-center">
        <Button href="/" variant="outline">
          ← Voltar
        </Button>
      </div>
    </div>
  </div>
</BaseLayout>

<script>
  import emailjs from '@emailjs/browser';

  const EMAILJS_SERVICE_ID = import.meta.env.PUBLIC_EMAILJS_SERVICE_ID || '';
  const EMAILJS_TEMPLATE_ID = import.meta.env.PUBLIC_EMAILJS_TEMPLATE_ID || '';
  const EMAILJS_PUBLIC_KEY = import.meta.env.PUBLIC_EMAILJS_PUBLIC_KEY || '';

  if (EMAILJS_PUBLIC_KEY) {
    emailjs.init(EMAILJS_PUBLIC_KEY);
  }

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contact-form');
    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const messageDiv = document.getElementById('form-message');
      const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;

      if (!EMAILJS_SERVICE_ID || !EMAILJS_TEMPLATE_ID || !EMAILJS_PUBLIC_KEY) {
        if (messageDiv) {
          messageDiv.className = 'p-4 rounded-lg bg-amber-500/20 border border-amber-500/50 text-amber-200';
          messageDiv.innerHTML = 'Formulário não configurado. Envie sua mensagem pelo <a href="https://wa.me/5531988435877" target="_blank" rel="noopener" class="underline">WhatsApp</a> ou para tilssilva1103@gmail.com';
          messageDiv.classList.remove('hidden');
        }
        return;
      }

      if (submitButton) {
        submitButton.disabled = true;
        (submitButton as HTMLButtonElement).innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Enviando...';
      }
      if (messageDiv) messageDiv.classList.add('hidden');

      try {
        const formData = new FormData(form);
        const templateParams = {
          from_name: formData.get('name'),
          from_phone: formData.get('phone'),
          from_email: formData.get('email'),
          message: formData.get('message'),
          to_email: 'tilssilva1103@gmail.com',
        };

        await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);

        if (messageDiv) {
          messageDiv.className = 'p-4 rounded-lg bg-green-500/20 border border-green-500/50 text-green-300';
          messageDiv.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Mensagem enviada! Retornaremos em breve.';
          messageDiv.classList.remove('hidden');
        }
        form.reset();
      } catch (err) {
        console.error('EmailJS error:', err);
        if (messageDiv) {
          messageDiv.className = 'p-4 rounded-lg bg-red-500/20 border border-red-500/50 text-red-300';
          messageDiv.innerHTML = '<i class="fas fa-exclamation-circle mr-2"></i>Erro ao enviar. Tente pelo <a href="https://wa.me/5531988435877" target="_blank" rel="noopener" class="underline">WhatsApp</a>.';
          messageDiv.classList.remove('hidden');
        }
      } finally {
        if (submitButton) {
          submitButton.disabled = false;
          (submitButton as HTMLButtonElement).innerHTML = 'Quero um orçamento';
        }
      }
    });
  });
</script>
