---
import BaseLayout from '../layouts/BaseLayout.astro';
import Button from '../components/ui/Button.astro';
import { CONTACT } from '../utils/constants';

const mapsEmbedUrl = 'https://www.google.com/maps?q=' + encodeURIComponent(CONTACT.address) + '&output=embed';
---

<BaseLayout
  title="Contato | RN Transportes e Mudanças"
  description="Fale conosco. Preencha o formulário ou entre em contato por telefone, email e WhatsApp. RN Transportes - Belo Horizonte."
  keywords="contato RN Transportes, mudanças BH contato, orçamento mudanças, telefone mudanças"
  canonical="https://rntransportesbh.com.br/contato"
  image="/banner-og.png"
  url="https://rntransportesbh.com.br/contato"
>
  <!-- 1. Primeira sessão: imagem de fundo (mulher apontando) + título integrado ao formulário -->
  <section
    class="relative pt-24 pb-16 md:pt-28 md:pb-20 min-h-[640px] md:min-h-[720px] flex items-center bg-cover bg-no-repeat bg-right"
    style="background-image: url('/assets/contato/hero-contato.png');"
  >
    <!-- Overlay: mais escuro à esquerda (onde fica o card), mais suave à direita (mulher visível) -->
    <div class="absolute inset-0 bg-gradient-to-r from-[var(--color-dark-blue)]/92 via-[var(--color-dark-blue)]/70 to-[var(--color-dark-blue)]/35" aria-hidden="true"></div>
    <div class="section-shapes absolute inset-0 pointer-events-none hidden md:block z-0" aria-hidden="true">
      <div class="absolute left-[2%] top-[18%] w-7 h-7 bg-[var(--color-yellow)] opacity-50 rotate-12"></div>
      <div class="absolute left-[1.5%] bottom-[22%] w-6 h-10 bg-[var(--color-cyan)] opacity-45 -rotate-6"></div>
      <div class="absolute right-[2%] top-[28%] w-6 h-6 bg-[var(--color-cyan)] opacity-50 -rotate-12"></div>
      <div class="absolute right-[1.5%] bottom-[18%] w-8 h-6 bg-[var(--color-yellow)] opacity-55 rotate-6"></div>
    </div>
    <div class="container relative z-10 mx-auto px-6">
      <div class="max-w-xl">
        <div class="bg-[var(--color-background-dark)]/95 backdrop-blur-sm rounded-xl p-6 md:p-8 border border-[var(--color-platinum)]/25 shadow-2xl">
          <h1 class="text-3xl md:text-4xl font-bold mb-2 text-[var(--color-platinum)]">
            Fale Conosco
          </h1>
          <p class="text-[var(--color-platinum)]/85 mb-6 leading-relaxed">
            Preencha o formulário que entraremos em contato com você.
          </p>
          <form id="contato-form" class="space-y-4">
            <div>
              <label for="contato-name" class="block text-[var(--color-platinum)] mb-1.5 text-sm font-medium">
                Nome completo <span class="text-red-400">*</span>
              </label>
              <input
                type="text"
                id="contato-name"
                name="name"
                required
                class="w-full px-4 py-2.5 bg-[var(--color-background)] border border-[var(--color-platinum)]/25 rounded-lg text-[var(--color-platinum)] focus:outline-none focus:ring-2 focus:ring-[var(--color-cyan)] focus:border-transparent text-sm"
                placeholder="Seu nome"
              />
            </div>
            <div>
              <label for="contato-address" class="block text-[var(--color-platinum)] mb-1.5 text-sm font-medium">
                Endereço
              </label>
              <input
                type="text"
                id="contato-address"
                name="address"
                class="w-full px-4 py-2.5 bg-[var(--color-background)] border border-[var(--color-platinum)]/25 rounded-lg text-[var(--color-platinum)] focus:outline-none focus:ring-2 focus:ring-[var(--color-cyan)] focus:border-transparent text-sm"
                placeholder="Rua, número, bairro"
              />
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label for="contato-phone" class="block text-[var(--color-platinum)] mb-1.5 text-sm font-medium">
                  Telefone <span class="text-red-400">*</span>
                </label>
                <input
                  type="tel"
                  id="contato-phone"
                  name="phone"
                  required
                  class="w-full px-4 py-2.5 bg-[var(--color-background)] border border-[var(--color-platinum)]/25 rounded-lg text-[var(--color-platinum)] focus:outline-none focus:ring-2 focus:ring-[var(--color-cyan)] focus:border-transparent text-sm"
                  placeholder="(31) 99999-9999"
                />
              </div>
              <div>
                <label for="contato-email" class="block text-[var(--color-platinum)] mb-1.5 text-sm font-medium">
                  Email <span class="text-red-400">*</span>
                </label>
                <input
                  type="email"
                  id="contato-email"
                  name="email"
                  required
                  class="w-full px-4 py-2.5 bg-[var(--color-background)] border border-[var(--color-platinum)]/25 rounded-lg text-[var(--color-platinum)] focus:outline-none focus:ring-2 focus:ring-[var(--color-cyan)] focus:border-transparent text-sm"
                  placeholder="seu@email.com"
                />
              </div>
            </div>
            <div>
              <label for="contato-message" class="block text-[var(--color-platinum)] mb-1.5 text-sm font-medium">
                Deixe aqui sua mensagem <span class="text-red-400">*</span>
              </label>
              <textarea
                id="contato-message"
                name="message"
                required
                rows="3"
                class="w-full px-4 py-2.5 bg-[var(--color-background)] border border-[var(--color-platinum)]/25 rounded-lg text-[var(--color-platinum)] focus:outline-none focus:ring-2 focus:ring-[var(--color-cyan)] focus:border-transparent resize-none text-sm"
                placeholder="Como podemos ajudar?"
              ></textarea>
            </div>
            <div id="contato-form-message" class="hidden p-3 rounded-lg text-sm"></div>
            <Button variant="primary" size="lg" class="w-full" type="submit">
              Enviar
            </Button>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- 2. Endereço e Contatos – mesma linha, em caixas centralizadas -->
  <section class="relative py-12 md:py-16 bg-[var(--color-background)]">
    <div class="section-shapes absolute inset-0 pointer-events-none hidden md:block z-0" aria-hidden="true">
      <div class="absolute left-[2%] top-[22%] w-6 h-6 bg-[var(--color-yellow)] opacity-60 rotate-6"></div>
      <div class="absolute right-[2%] bottom-[25%] w-8 h-8 bg-[var(--color-cyan)] opacity-55 -rotate-6"></div>
    </div>
    <div class="container relative z-10 mx-auto px-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8 max-w-4xl mx-auto">
        <div class="p-6 md:p-8 bg-[var(--color-background-dark)] rounded-lg border border-[var(--color-platinum)]/20 hover:border-[var(--color-cyan)]/40 transition-all duration-300">
          <h2 class="text-xl md:text-2xl font-bold mb-4 text-[var(--color-cyan)]">
            Endereço
          </h2>
          <p class="text-[var(--color-platinum)]/90 leading-relaxed">
            Rua Nigéria, 78, Loja B – Canaã<br />
            Belo Horizonte/MG<br />
            CEP: {CONTACT.cep}
          </p>
        </div>
        <div class="p-6 md:p-8 bg-[var(--color-background-dark)] rounded-lg border border-[var(--color-platinum)]/20 hover:border-[var(--color-cyan)]/40 transition-all duration-300">
          <h2 class="text-xl md:text-2xl font-bold mb-4 text-[var(--color-cyan)]">
            Contatos
          </h2>
          <ul class="space-y-3 text-[var(--color-platinum)]/90">
            <li>
              <a href={`tel:+55${CONTACT.phone.replace(/\D/g, '')}`} class="hover:text-[var(--color-cyan)] transition-colors inline-flex items-center gap-3">
                <i class="fas fa-phone text-[var(--color-cyan)] w-5"></i>
                {CONTACT.phone}
              </a>
            </li>
            <li>
              <a href={`mailto:${CONTACT.email}`} class="hover:text-[var(--color-cyan)] transition-colors inline-flex items-center gap-3">
                <i class="fas fa-envelope text-[var(--color-cyan)] w-5"></i>
                {CONTACT.email}
              </a>
            </li>
            <li>
              <a href={`https://wa.me/${CONTACT.whatsapp}`} target="_blank" rel="noopener noreferrer" class="hover:text-[var(--color-cyan)] transition-colors inline-flex items-center gap-3">
                <i class="fab fa-whatsapp text-[var(--color-cyan)] w-5"></i>
                WhatsApp
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- 3. Como chegar – sessão horizontal sozinha -->
  <section class="relative py-12 md:py-16 bg-[var(--color-background)]">
    <div class="section-shapes absolute inset-0 pointer-events-none hidden md:block z-0" aria-hidden="true">
      <div class="absolute left-[2%] top-[30%] w-7 h-9 bg-[var(--color-cyan)] opacity-55 -rotate-3"></div>
      <div class="absolute right-[2%] bottom-[20%] w-6 h-8 bg-[var(--color-yellow)] opacity-62 rotate-12"></div>
    </div>
    <div class="container relative z-10 mx-auto px-6">
      <h2 class="text-2xl md:text-3xl font-bold mb-6 text-[var(--color-platinum)] text-center">
        Como chegar
      </h2>
      <div class="w-full rounded-xl overflow-hidden border border-[var(--color-platinum)]/20 shadow-lg">
        <iframe
          src={mapsEmbedUrl}
          width="100%"
          height="340"
          style="border:0;"
          allowfullscreen=""
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade"
          title="Localização RN Transportes e Mudanças"
        ></iframe>
      </div>
      <p class="mt-3 text-sm text-[var(--color-platinum)]/60">
        <a href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(CONTACT.address)}`} target="_blank" rel="noopener noreferrer" class="text-[var(--color-cyan)] hover:underline">
          Abrir no Google Maps →
        </a>
      </p>
    </div>
  </section>

  <!-- 4. CTA -->
  <section class="relative py-20 md:py-24 bg-gradient-to-br from-[var(--color-dark-blue)]/15 via-[var(--color-background)] to-[var(--color-cyan)]/15">
    <div class="section-shapes absolute inset-0 pointer-events-none hidden md:block z-0" aria-hidden="true">
      <div class="absolute left-[2%] top-[22%] w-6 h-6 bg-[var(--color-yellow)] opacity-60 rotate-6"></div>
      <div class="absolute left-[1.5%] bottom-[25%] w-7 h-9 bg-[var(--color-cyan)] opacity-55 -rotate-3"></div>
      <div class="absolute right-[2%] top-[18%] w-8 h-6 bg-[var(--color-cyan)] opacity-58 -rotate-6"></div>
      <div class="absolute right-[1.5%] bottom-[28%] w-6 h-7 bg-[var(--color-yellow)] opacity-62 rotate-10"></div>
    </div>
    <div class="container relative z-10 mx-auto px-6 text-center">
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold mb-6 text-[var(--color-platinum)]">
        Faça um orçamento!
      </h2>
      <p class="text-lg md:text-xl text-[var(--color-platinum)]/85 mb-10 max-w-2xl mx-auto">
        Preencha o formulário e solicite seu orçamento gratuito.
      </p>
      <Button href="/orcamento" variant="primary" size="lg">
        Quero um orçamento
      </Button>
    </div>
  </section>
</BaseLayout>

<script>
  import emailjs from '@emailjs/browser';

  const EMAILJS_SERVICE_ID = import.meta.env.PUBLIC_EMAILJS_SERVICE_ID || '';
  const EMAILJS_TEMPLATE_ID = import.meta.env.PUBLIC_EMAILJS_TEMPLATE_ID || '';
  const EMAILJS_PUBLIC_KEY = import.meta.env.PUBLIC_EMAILJS_PUBLIC_KEY || '';

  if (EMAILJS_PUBLIC_KEY) {
    emailjs.init(EMAILJS_PUBLIC_KEY);
  }

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contato-form');
    if (!form) return;

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const messageDiv = document.getElementById('contato-form-message');
      const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;

      if (!EMAILJS_SERVICE_ID || !EMAILJS_TEMPLATE_ID || !EMAILJS_PUBLIC_KEY) {
        if (messageDiv) {
          messageDiv.className = 'p-4 rounded-lg bg-amber-500/20 border border-amber-500/50 text-amber-200';
          messageDiv.innerHTML = 'Formulário não configurado. Envie sua mensagem pelo <a href="https://wa.me/5531988435877" target="_blank" rel="noopener" class="underline">WhatsApp</a>.';
          messageDiv.classList.remove('hidden');
        }
        return;
      }

      if (submitButton) {
        submitButton.disabled = true;
        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Enviando...';
      }
      if (messageDiv) messageDiv.classList.add('hidden');

      try {
        const formData = new FormData(form);
        const templateParams = {
          from_name: formData.get('name'),
          from_address: formData.get('address') || '',
          from_phone: formData.get('phone'),
          from_email: formData.get('email'),
          message: formData.get('message'),
          to_email: 'tilssilva1103@gmail.com',
        };

        await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams);

        if (messageDiv) {
          messageDiv.className = 'p-4 rounded-lg bg-green-500/20 border border-green-500/50 text-green-300';
          messageDiv.innerHTML = '<i class="fas fa-check-circle mr-2"></i>Mensagem enviada! Entraremos em contato em breve.';
          messageDiv.classList.remove('hidden');
        }
        form.reset();
      } catch (err) {
        console.error('EmailJS error:', err);
        if (messageDiv) {
          messageDiv.className = 'p-4 rounded-lg bg-red-500/20 border border-red-500/50 text-red-300';
          messageDiv.innerHTML = '<i class="fas fa-exclamation-circle mr-2"></i>Erro ao enviar. Tente pelo <a href="https://wa.me/5531988435877" target="_blank" rel="noopener" class="underline">WhatsApp</a>.';
          messageDiv.classList.remove('hidden');
        }
      } finally {
        if (submitButton) {
          submitButton.disabled = false;
          submitButton.innerHTML = 'Enviar';
        }
      }
    });
  });
</script>
